<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="earthquake-hub-backend" href="ehub-backend/overview.html" /><link rel="prev" title="System Overview" href="system-overview.html" />

    <link rel="shortcut icon" href="_static/upri-favicon.ico"/><!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>earthquake-hub-commons - UPRI EarthquakeHub Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-header-background: #3a6a50;
  --color-header-text: #fcfbf3;
  --color-sidebar-link-text--top-level: #3a6a50;
  --color-background-primary: #fcfbf3;
  --color-background-secondary: #f1f1e8;
  --color-link: #225ebc;
  --color-toc-item-text--hover: fcfbf3;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-header-background: #3a6a50;
  --color-header-text: #d9e8e5;
  --color-sidebar-link-text--top-level: #3a6a50;
  --color-link: #00b0ff;
  --color-background-secondary: #28292a;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-header-background: #3a6a50;
  --color-header-text: #d9e8e5;
  --color-sidebar-link-text--top-level: #3a6a50;
  --color-link: #00b0ff;
  --color-background-secondary: #28292a;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">UPRI EarthquakeHub Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/upri-logo-92x92.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">UPRI EarthquakeHub Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="connect-to-rshake.html">How to Connect to Your Raspberry Shake via SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-rshake-client.html">Installing EarthquakeHub Client on Raspberry Shake</a></li>
<li class="toctree-l1"><a class="reference internal" href="sending-data-to-ehub-network.html">Sending Data to EarthquakeHub Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="acquiring-new-token.html">Acquiring New Token for your rShake Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="fdsnws.html">How to Use FDSNWS to Download Ground Motion Data and Station Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-metadata-using-python.html">Programmatically Getting the Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro-to-seiscomp.html">Introduction To SeisComp</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide-contributing.html">Developer Guide: Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker-cheatsheet.html">Developer Guide: Docker Cheatsheet</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="system-overview.html">System Overview</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">earthquake-hub-commons</a></li>
<li class="toctree-l1"><a class="reference internal" href="ehub-backend/overview.html">earthquake-hub-backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="ehub-frontend.html">earthquake-hub-frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="sender-backend/overview.html">sender-backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="sender-frontend.html">sender-frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="ringserver.html">RingServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="slink2dali.html">Slink2Dali</a></li>
<li class="toctree-l1"><a class="reference internal" href="significant-eqs.html">Significant Earthquakes in UPRI Citizen Science Seismic Network</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Issues</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="issues/rshake-ntp-issue.html">RShake NTP Timing Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues/blank-rs.local-page.html">Blank rs.local Page Due to 100% Utilization of Device Storage</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/ehub-commons.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="earthquake-hub-commons">
<h1>earthquake-hub-commons<a class="headerlink" href="#earthquake-hub-commons" title="Link to this heading">¶</a></h1>
<section id="what-is-the-earthquake-hub-commons-intended-for">
<h2>What is the earthquake-hub-commons intended for<a class="headerlink" href="#what-is-the-earthquake-hub-commons-intended-for" title="Link to this heading">¶</a></h2>
<p>This repository integrates all the essential programs necessary for hosting a citizen science network of ground motion sensors<a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>  It enables data transmission, archiving, and allows feeding the network data to earthquake detection software<a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.
A version of this repository is deployed live on <a href="https://earthquake.science.upd.edu.ph" target="_blank">earthquake.science.upd.edu.ph.</a></p>
</section>
<section id="server-deployment-via-docker-compose">
<h2>Server Deployment via Docker Compose<a class="headerlink" href="#server-deployment-via-docker-compose" title="Link to this heading">¶</a></h2>
<p>There are two different docker-compose files written for two scenarios, <em>(1)</em> for <em>deploying in a server</em> and <em>(2)</em> for <em>development/testing</em> in your local machine.</p>
<ol class="arabic">
<li><p><strong>Clone the repository:</strong> Begin by cloning <a href="https://github.com/UPRI-earthquake/earthquake-hub-commons.git" target="_blank">this repository</a> to your local machine using the git clone command.</p></li>
<li><p><strong>Install Docker:</strong> Make sure you have <a href="https://docs.docker.com/get-docker/" target="_blank">Docker</a> installed on your system. Docker Compose is essential for managing multi-container Docker applications.</p></li>
<li><p><strong>Configure env variables:</strong> Create a file named .env in the root of the repository, and add the necessary configuration variables. You can find an example of these variables in the .env.example file.</p></li>
<li><p><strong>Set up nginx certificates:</strong> For this, there will be another series of steps to be done. These steps will only be done during development/testing to replicate the deployment server enviroment into your local machine; to ensure that you have valid SSL certificates for Nginx.</p>
<ul>
<li><p>Create a locally trusted self-signed SSL certificate (you may use <a href="https://www.howtoforge.com/how-to-create-locally-trusted-ssl-certificates-with-mkcert-on-ubuntu/" target="_blank">mkcert</a> to do this). And store the <code class="docutils literal notranslate"><span class="pre">pem</span></code> files in <code class="docutils literal notranslate"><span class="pre">https_data/certbot/conf/live/&lt;server-name&gt;/</span></code></p></li>
<li><p>Configure the <a href="https_data/nginx.dep-test.d/nginx.dep-test.conf" target="_blank">nginx configuration file</a></p>
<blockquote>
<div><p>If you name your <code class="docutils literal notranslate"><span class="pre">pem</span></code> files as <code class="docutils literal notranslate"><span class="pre">localhost.pem</span></code> and <code class="docutils literal notranslate"><span class="pre">localhost-key.pem</span></code>, and then store them in the folder <code class="docutils literal notranslate"><span class="pre">https_data/certbot/conf/live/localhost/</span></code>, then you shouldn’t have to alter the nginx configuration file.</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">server_name</span></code> must match the one set for the certificates</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssl_certificate</span></code> and <code class="docutils literal notranslate"><span class="pre">ssl_certificate_key</span></code> should both correspond to the location and filenames of the previously generated <code class="docutils literal notranslate"><span class="pre">pem</span></code> files.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Create MongoDB volume:</strong> Run the following command to create a docker volume for mongodb data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>volume<span class="w"> </span>create<span class="w"> </span>earthquake-hub-mongodb-data
</pre></div>
</div>
</li>
<li><p><strong>Run the containers:</strong> Once the setup is configured, run the following Docker Compose command to start all the necessary containers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>compose<span class="w"> </span>--env-file<span class="w"> </span>.dep-test.env<span class="w"> </span>up<span class="w"> </span>--build
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If ever you encounter an error saying you are unauthorized to pull image, follow this guide on how to <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-with-a-personal-access-token-classic" target="_blank">authenticate with personal access token from <code class="docutils literal notranslate"><span class="pre">ghcr.io</span></code> </a></p></li>
<li><p>To get the certificates using <code class="docutils literal notranslate"><span class="pre">certbot</span></code>, First up the nginx-proxy container but with the https server in the nginx.conf file commented out. Second, fill this in via certbot: <code class="docutils literal notranslate"> <span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">run</span> <span class="pre">--rm</span>&#160; <span class="pre">certbot</span> <span class="pre">certonly</span> <span class="pre">--webroot</span> <span class="pre">--webroot-path</span> <span class="pre">/var/www/certbot/</span> <span class="pre">-d</span> <span class="pre">&lt;your-webapp-url&gt;.org</span></code>.</p></li>
<li><p>Lastly, add the 443 (or https) config for the nginx and restart that container.</p></li>
<li><p>Within a few months, the certificate will expire. To renew using certbot, use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">run</span> <span class="pre">--rm</span> <span class="pre">certbot</span> <span class="pre">renew</span></code></p></li>
</ul>
</div>
<p><strong>The docker compose command will start the following containers:</strong></p>
<ul class="simple">
<li><p><strong>Nginx Proxy:</strong> This acts as a reverse proxy server which handles incoming HTTP/HTTPS traffic and distributes it to the corresponding services within the Docker network.</p></li>
<li><p><strong>Earthquake-hub-frontend:</strong> This hosts the front-end application for the earthquake-hub network which serves the user interface and interacts with the backend services to display data and handle user requests.</p></li>
<li><p><strong>Earthquake-hub-backend:</strong> This hosts the back-end application for the earthquake-hub network. It handles various functionalities, such as user authentication, data processing, and database interactions, to support the front-end application and process incoming data from the sensors.</p></li>
<li><p><strong>MongoDB:</strong> This is a NoSQL database used to store and manage data, such as account information, device information, and recorded seismic events, within the earthquake-hub network.</p></li>
<li><p><strong>Ringserver:</strong> This is a TCP-based ring buffer designed for packetized streaming data which utilizes time-series data from various station, archive seismic data, and serve those data (or diagnostics of such data) towards the clients.</p></li>
<li><p><strong>Certbot:</strong> This is a tool used to automatically obtain and manage SSL/TLS certificates from the Let’s Encrypt Certificate Authority that provides valid SSL certificate for the server’s domain which ensures secure communication between the server and its clients. You may refer to this <a class="reference external" href="https://mindsers.blog/post/https-using-nginx-certbot-docker/">post</a> on how to request SSL certificate using docker compose.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Certbot needs to be renewed <b> every three (3) months </b> to keep the certificates valid and up-to-date. Certificate renewal process can easily be done using the following command:
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">run</span> <span class="pre">--rm</span> <span class="pre">certbot</span> <span class="pre">renew</span></code></p>
</div>
<ul class="simple">
<li><p><strong>Geoserve:</strong> This is a service that provides geographic information for the earthquake-hub network. It is used to convert latitude and longitude values into names of places, such as their city name, region, and country name.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Certbot and Geoserve are not used in local development/testing. The two will only be run using the docker compose which is intended for deploying in a server.</p></li>
<li><p>Certbot needs to renew the SSL certificates every three (3) months.</p></li>
</ul>
</div>
<ol class="arabic" start="7">
<li><p><strong>Configure ringserver:</strong> Make sure that ringserver-configs/auth/secret.key exists (contains brgy token to AuthServer). Then set the <em>AuthServer</em> value in ringserver-configs/ring.conf to the AuthServer API address (i.e. http://172.21.0.3:5000 or https://earthquake.science.upd.edu.ph/api).</p>
<ul>
<li><p>You may use curl to request an accessToken using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;&lt;USERNAME&gt;&quot;,&quot;password&quot;: &quot;&lt;PASSWORD&gt;&quot;,&quot;role&quot;: &quot;brgy&quot;}&#39;</span><span class="w"> </span>https://&lt;EARTHQUAKE-HUB-BACKEND-URL&gt;/accounts/authenticate
</pre></div>
</div>
</li>
<li><p>or you may use Postman to send a POST request to <code class="docutils literal notranslate"><span class="pre">/accounts/authenticate</span></code> endpoint of the <code class="docutils literal notranslate"><span class="pre">earthquake-hub-backend</span></code> url with the the following body:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;USERNAME&gt;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;PASSWORD&gt;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brgy&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please change the <code class="docutils literal notranslate"><span class="pre">&lt;USERNAME&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;PASSWORD&gt;</span></code> parameters with your credentials.</p>
</li>
</ul>
</li>
</ol>
</section>
<section id="interfacing-with-a-processor">
<h2>Interfacing with a processor<a class="headerlink" href="#interfacing-with-a-processor" title="Link to this heading">¶</a></h2>
<section id="seiscomp">
<h3>SeisComP<a class="headerlink" href="#seiscomp" title="Link to this heading">¶</a></h3>
<p>The earthquake-hub-commons repository allows easy interfacing with earthquake processing softwares such as SeisComP (Seismic Communication Processor) which is a widely used earthquake detection  and seismic data processing software.
SeisComP is a collection of <em>software modules</em> used to for seismic data transmission, processing, analysis, monitoring, and archiving. These functions can be done in both real-time and offline.
For further information about SeisComP check this <a href="https://www.seiscomp.de/doc/index.html" target="_blank">overview</a> on how to get started with SeisComP.</p>
</section>
<section id="backend-endpoints-and-python-scripts">
<h3>Backend Endpoints and Python Scripts<a class="headerlink" href="#backend-endpoints-and-python-scripts" title="Link to this heading">¶</a></h3>
<p>This repository exposes two Server-Sent-Event endpoints (<code class="docutils literal notranslate"><span class="pre">/messaging/restricted/new-pick</span></code> and <code class="docutils literal notranslate"><span class="pre">/messaging/restricted/new-event</span></code>) and run two Python scripts to interact with the processor. The two python scripts are run as systemd services which publish <code class="docutils literal notranslate"><span class="pre">pick</span> <span class="pre">events</span></code> and <code class="docutils literal notranslate"><span class="pre">recorded</span> <span class="pre">seismic</span> <span class="pre">events</span></code> from SeisComP to the aforementioned endpoints.</p>
</section>
<section id="mongodb-and-data-population">
<h3>MongoDB and Data Population<a class="headerlink" href="#mongodb-and-data-population" title="Link to this heading">¶</a></h3>
<p>We have included scripts to help initialize mongodb’s <code class="docutils literal notranslate"><span class="pre">events</span></code> collection with SeisComP event data in the scenario that you have an existing record of SeisComP detections that you want to migrate into your instance of EarthquakeHub.</p>
</section>
</section>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>such as but not limited to raspberryshakes</p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>such as but not limited to SeisComP</p>
</aside>
</aside>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ehub-backend/overview.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">earthquake-hub-backend</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="system-overview.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">System Overview</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, UPRI
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">earthquake-hub-commons</a><ul>
<li><a class="reference internal" href="#what-is-the-earthquake-hub-commons-intended-for">What is the earthquake-hub-commons intended for</a></li>
<li><a class="reference internal" href="#server-deployment-via-docker-compose">Server Deployment via Docker Compose</a></li>
<li><a class="reference internal" href="#interfacing-with-a-processor">Interfacing with a processor</a><ul>
<li><a class="reference internal" href="#seiscomp">SeisComP</a></li>
<li><a class="reference internal" href="#backend-endpoints-and-python-scripts">Backend Endpoints and Python Scripts</a></li>
<li><a class="reference internal" href="#mongodb-and-data-population">MongoDB and Data Population</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>